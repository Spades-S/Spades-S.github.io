<!DOCTYPE html>
<html lang="zh-CN">



<!-- Head tag -->
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
    
    <title>
    
        ghost in vertical-align - 
    
    Spades
    </title>
    
    <meta name="keywords" content="">
    <meta name="description" content="Warning: inexperienced programmer inside!">
    <meta name="author" content="Dr. A. Clef">
    
    <link rel="alternate" type="application/atom+xml" hrel="/atom.xml">
    
    <link rel="Shortcut Icon" href="/favicon.ico" type="image/x-icon">
    
    <link href="/css/style.css" rel="stylesheet" type="text/css">
    <link href="/css/responsive.css" rel="stylesheet" type="text/css" media="screen and (max-width: 768px)">
    <link href="https://cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://cdn.bootcss.com/cc-icons/1.2.1/css/cc-icons.min.css" rel="stylesheet" type="text/css">
    <script src="https://cdn.bootcss.com/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery_lazyload/1.9.7/jquery.lazyload.min.js"></script>
    <script src="/js/dropdown.js" type="text/javascript" async></script>
    <script src="/js/sidebar.js" type="text/javascript" async></script>
    
</head>


<body class="single">
    <div id="header">
    <div class="container clearfix">
        <div class="logo" style="width: auto;">
            <a href="/" title="Spades" rel="home" style="text-decoration: none;">
                
                <span class="brand-logo">
                    
                    Spades
                    
                
                </span>
            </a>
        </div>
        
<form method="get" class="search-form" action="/search.html">
    <input type="text" name="s" class="search-input" placeholder="输入关键词" />
    <button type="submit" class="search-submit">
        <span class="fa fa-search"></span>
    </button>
</form>


        <div class="global-nav">
            <ul class="gnul">
                <li class="gnli ">
                    <a class="gna" href="/" title="Spades">
                        <span class="fa fa-home"></span><span>主页</span>
                    </a>
                </li>
                
                <li class="gnli dropdown current">
                    <a class="gna dropdown-link fa fa-bars" href="javascript:;">
                        <span>导航</span>
                    </a>
                    <div class="dropdown-arrow1"></div>
                    <div class="dropdown-arrow2"></div>
                    <div class="submenu">
                        <div class="tab-content">
                            <table>
                                <tbody>
                                    
                                    <tr class="trline">
                                        <td class="tdleft">分类</td>
                                        <td class="tdright">
                                            <div class="tab-categories">
                                                <ul>
                                                
                                                    <li class="cat-item">
                                                        <a href="/categories/CSS/">CSS</a>
                                                    </li>
                                                
                                                    <li class="cat-item">
                                                        <a href="/categories/JavaScript/">JavaScript</a>
                                                    </li>
                                                
                                                    <li class="cat-item">
                                                        <a href="/categories/readlist/">readlist</a>
                                                    </li>
                                                
                                                    <li class="cat-item">
                                                        <a href="/categories/工程/">工程</a>
                                                    </li>
                                                
                                                    <li class="cat-item">
                                                        <a href="/categories/运维/">运维</a>
                                                    </li>
                                                
                                                    <li class="cat-item">
                                                        <a href="/categories/随笔/">随笔</a>
                                                    </li>
                                                
                                                </ul>
                                            </div>
                                        </td>
                                    </tr>
                                    
                                    <!-- <tr>
                                        <td class="tdleft">标签</td>
                                        <td class="tdright">
                                            <div class="tab-tags">
                                                <a href="/tags/阅读整理/" style="font-size: 12px;">阅读整理</a> <a href="/tags/个人总结/" style="font-size: 12px;">个人总结</a> <a href="/tags/杂感/" style="font-size: 12px;">杂感</a>
                                            </div>
                                        </td>
                                    </tr> -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </li>
                
                
                <li class="gnli">
                    <a class="gna" href="/archives/" title="">
                        <span class="fa fa-archive"></span>归档
                    </a>
                </li>
                
                <li class="gnli">
                    <a class="gna" href="/about/" title="">
                        <span class="fa fa-user"></span>关于
                    </a>
                </li>
                
                <li class="gnli">
                    <a class="gna" href="/2017-08-29-readlist" title="">
                        <span class="fa fa-book"></span>阅读列表
                    </a>
                </li>
                
                
                
            </ul>
        </div>
    </div>
        <div id="motto">
            
        </div>
</div>

    <div id="content">
    <div class="container clearfix">
        <div id="primary" class="no-toc">
            
            <div class="breadcrumb-navigation">
                <a rel="bookmark" href="/">
                    主页
                </a>
                <span class="breadcrumb-arrow fa fa-angle-right"></span>
                 
<a href="/categories/CSS/" title="CSS" rel="category tag">CSS</a>

                    <span class="breadcrumb-arrow fa fa-angle-right"></span>
                    ghost in vertical-align
            </div>
            
            <div class="single-post">
              
                <div class="post-header">
                    <h2 class="post-title">
                        <a href="/2017-11-24-ghost-in-vertical-align/" title="ghost in vertical-align">
                            ghost in vertical-align
                        </a>
                    </h2>
                </div>
              
                 <div class="post-meta">
                    <ul class="inline-ul">
                        <li class="inline-li">
                            2017-11-24
                        </li>
                        
                        <li class="inline-li">
                            <span class="post-span">·</span>
                        </li>
                        <li class="inline-li">
                             
<a href="/categories/CSS/" title="CSS" rel="category tag">CSS</a>

                        </li>
                        
                        
                        <li class="inline-li">
                            <span class="post-span">·</span>
                        </li>
                        <li class="inline-li">
                            <span id="busuanzi_value_page_pv"></span> Views
                        </li>
                        
                    </ul>
                </div>
                <div class="post-body clearfix">
                    <div class="post-content">
                        
                                <p>Thanks to <a href="http://www.zhangxinxu.com/wordpress/2015/08/css-deep-understand-vertical-align-and-line-height/" target="_blank" rel="noopener">CSS深入理解vertical-align和line-height的基友关系</a>、 <a href="https://iamvdo.me/en/blog/css-font-metrics-line-height-and-vertical-align" target="_blank" rel="noopener">Deep dive CSS: font metrics, line-height and vertical-align</a></p>
<p>在布局的时候常常会发现，这个地方怎么多出来一块，理论上应该没有啊，这个“灵异事件”是怎么产生的？有一种“ghost”是隐藏在vertical-align下的，我们来一步一步抓住它。</p>
<p>首先看下存在“ghost”是啥样子<br><img src="/2017-11-24-ghost-in-vertical-align/ghost1.png" title="[title]"><br><br>实现的代码上面布局的代码:<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        * &#123;</span></span><br><span class="line"><span class="undefined">            margin-top: 0;</span></span><br><span class="line"><span class="undefined">            box-sizing: border-box;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        </span></span><br><span class="line"><span class="undefined">        div &#123;</span></span><br><span class="line"><span class="undefined">            margin-top: 50px;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background</span>: <span class="selector-id">#bebece</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        </span></span><br><span class="line"><span class="undefined">        img &#123;</span></span><br><span class="line"><span class="undefined">            height: 200px;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./anywhere.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>代码结构非常近简单，一个有背景色的div和一张图片，按照常规的逻辑div的高度应该和img的高度一致，div里面只有img，计算高度时只有img的高度，但是奇怪的是，div的高度却要比img高出一些(见上图红框)</p>
<p>为什么会出现这种奇怪的东西呢？张鑫旭用了一个自定义的概念解释了这个现象，“幽灵空白”节点，一个块容器中藏着一个幽灵空白节点，看不见摸不着，但的确存在！</p>
<p>确实像张鑫旭说的那样，在一个块级容器中存在一个“无色无味不可触摸”的幽灵空白节点：<br><img src="/2017-11-24-ghost-in-vertical-align/ghost2.png"><br>上面的截图中，img下面都具有相同的空隙，但是不同的是<code>在img边上是否存在文字</code>。<br>上面那个图是由如下的代码实现的：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">        * &#123;</span></span><br><span class="line"><span class="undefined">            margin-top: 0;</span></span><br><span class="line"><span class="undefined">            box-sizing: border-box;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        </span></span><br><span class="line"><span class="undefined">        div &#123;</span></span><br><span class="line"><span class="undefined">            margin-top: 50px;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background</span>: <span class="selector-id">#bebece</span>;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">        </span></span><br><span class="line"><span class="undefined">        img &#123;</span></span><br><span class="line"><span class="undefined">            height: 200px;</span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="undefined">    </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./anywhere.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./anywhere.jpg"</span> <span class="attr">alt</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>spades<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>从代码上加以分析，两个div唯一的不同点：是否具有span。div内部加上span之后img表现出的效果竟然和没有span时一致，那么对于第二个div来说，img下面的那个空隙是由span撑开的吗？给span加个背景看看吧<br><img src="/2017-11-24-ghost-in-vertical-align/ghost3.png"><br>从截图上直观地说，span确实是造成img下面有空隙的元凶。既然span是元凶，如果它的高度为0，从逻辑上来讲img下面的空隙就会消失。<br>将span的font-size设为0：<br><img src="/2017-11-24-ghost-in-vertical-align/ghost4.png"><br>将span的font-size设置为0之后，span的确是消失了，但是img下面还是存在空隙。如果div里面真的有一个幽灵元素，并且img下的空隙的确是由那个幽灵空白元素造成的，那只给span设置font-size是不是不太够，也需要给那个幽灵元素设置下font-size<br>在div上设置font-size：<br><img src="/2017-11-24-ghost-in-vertical-align/ghost5.png"><br>将divfont-size设置为0之后，img下的空隙消失了，在第一个div上设置font-size，img下的空隙同样消失。<br>到此我们可以知道，一个块级元素里的确存在一个幽灵空白节点。w3c spec上是这么说的：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">On a block container element whose content is composed of inline-level elements, &apos;line-height&apos; specifies the minimal height of line  </span><br><span class="line">boxes within the element. The minimum height consists of a minimum height above the baseline and a minimum depth below it, exactly as </span><br><span class="line">if each line box starts with a zero-width inline box with the element&apos;s font and line height properties. We call that imaginary box a</span><br><span class="line">&quot;strut.&quot;</span><br></pre></td></tr></table></figure></p>
<p>w3c spec这段话的意思是说，对于一个内部只有内联元素的块级元素，它的最小高度里包含了minimum height，这个minimum height在baseline上下各有一个，就像是在这个块级容器中有一个宽度为0的元素一样。</p>
<p>对于vartical-align，默认的值是baseline：align the baseline of the box with the baseline of parent box. If the box does not have a baseline, align the bottom with the parent’s baseline.<br>vertical-align 还有其他几个值：<br>—— middle: align the vertical midpoint of the box with the baseline of the parent box plus half the x-height of the parent.<br>—— sub: lower the baseline of the box to the proper position for subscripts of the parent’s box.(This value has no effect on the font size of the element’s text)<br>—— super: raise the baseline of the box to the proper position for superscripts of the parent’s box.(This value has no effect on the font size of the element’s text)<br>—— text-top: align the top of the box with the top of the parent’s content area.<br>—— text-bottom: align the bottom of the box with the bottom of the parent’s content area.<br>—— percentage<br>—— length<br><strong>The vertical-align property affects the vertical positioning inside a line box of the boxes generated by an inline-level element. The values only have meaning with respect to a parent inline element, or to the strut of a parent block container element</strong></p>
<p><strong>for inline non-replaced elements, the box used for alignment is the box whose height is the “line-height”. For other elements, the box used for alignment is the margin box</strong><br>张鑫旭在他的文章里也提到了类似的表述，“css2 可视化格式文档模型中的一段话：The baseline of an ‘inline-block’ is the baseline of its last line box , unless it has either no in-flow line boxes or if its overflow property has a computed value other than visible, in which case the baseline is the bottom margin edge.” 在这里顺便借用下张鑫旭对这段话的翻译：“一个inline-block元素，如果里面没有inline内联元素，或者overflow不是visible，那么该元素的基线就是其margin底边边缘；否则，基线就是元素里面最后一行内联元素的基线”</p>
<p>除了上面的值之外，vertical-align还可以去top和bottom：<br>—— top: align the top of the aligned subtree with the top of the line box.<br>—— bottom: align the bottom of the aligned subtree with the bottom of the line box.</p>
<p>回到最初的话题，为什么img下会有空隙呢？原因在于，img 和 幽灵空白节点 的 vertical-align默认值均为baseline，对于img其baseline是margin底边缘，幽灵空白节点的baseline并不是margin底边缘（如下图中的span中文字节点的baseline，span的baseline并不是margin底边缘），所以会出现空隙<br><img src="/2017-11-24-ghost-in-vertical-align/ghost6.png"></p>

                    </div>
                </div>
                  
                <div class="post-tags">
                    
                        
                            <a href="/tags/个人总结/" title="个人总结" rel="tag" class="fa fa-tag">
                                个人总结
                            </a>
                            
                                
                </div>
                <ul class="pager">

    <li class="previous">
        <a href="/2017-12-31-清除浮动/" title="清除浮动" class="tooltipped tooltipped-n" aria-label="清除浮动"><i class="fa fa-chevron-left"></i> 上一篇文章</a>
    </li>
    
    
    <li class="next">
        <a href="/2017-08-29-readlist/" title="readlist" class="tooltipped tooltipped-n" aria-label="readlist">下一篇文章 <i class="fa fa-chevron-right"></i></a>
    </li>
    
</ul>

                  
            </div>
              
            
<div id="container"  style="margin-top: 70px"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
    var gitment = new Gitment({
    id:'undefined',
    owner: 'Spades-S',
    repo: 'SpadesComments',
    oauth: {
        client_id: '97c0bf26004470371f4e',
        client_secret: '2cc70304d7b9e02d6dd486319038673daebab9d9',
    },
    })
gitment.render('container')
</script>


              
        </div>
        <!-- #primary -->
        
    </div>
     

</div>
    <!-- Footer -->
    
<!-- #content -->
<div id="footer">
    <div class="container">
        <p>
            <span class="cc-license">
                <a href="https://creativecommons.org/licenses/by-sa/4.0" target="_blank" title="Creative Commons license by-sa">
                <i class="cc cc-cc"></i>
                
                    <i class="cc cc-by"></i>
                
                    <i class="cc cc-sa"></i>
                
                </a>
            </span>
            2017.2-2018 Spades.
        </p>
        <p>Themed by <a href="https://github.com/unnamed42/hexo-theme-kunkka">Kunkka</a> | Powered by <a href="https://hexo.io/">Hexo</a>.</p>
        


<div class="sns-icons">
    
        
        
    
        
        
    
        
        
    
        
        
    
        
        
    
        
        
    
        
        
    
        
        
    
        
        
    
</div>


    </div>
</div>
<!-- #footer -->

    <!-- Totop -->
<div id="backtoTop" data-action="gototop" title="送你上天">
    <canvas id="backtoTopCanvas" width="48" height="48"></canvas>
    <div class="percentage"></div>
</div>

<script src="/js/totop.js" type="text/javascript" async></script>


<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
            processEscapes: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
    });
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>


<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</body>

</html>
